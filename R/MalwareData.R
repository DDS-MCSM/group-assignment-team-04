library(dplyr)

#' Updates malware domain information csv
#'
#' This return the malware informaiton extracted from http://www.malwaredomainlist.com
#'
#' @export
update_malware_data <- function()
{
  mdlfile <- "./data/malware-domain-list.csv"
  utils::download.file(url="http://www.malwaredomainlist.com/mdlcsv.php", destfile = mdlfile, quiet = F)
}

#' Returns a dataframe with malware domain information
#'
#' This return the malware informaiton extracted from http://www.malwaredomainlist.com
#' @return A dataframe with malware information with the following columns:
#' Date, Domain, domainParsed, IP, ReverseLookup, Description, ASN, Country
#' @export
read_malware_data <- function()
{
  mdlfile <- "./data/malware-domain-list.csv"
  if (!file.exists(mdlfile))
  {
    update_malware_data();
  }

  malwareRead <- read.csv(file = mdlfile,
                          header = F,
                          col.names = c("Date", "Domain", "IP", "ReverseLookup", "Description","Registrant", "ASN","none", "Country","end"),
                          stringsAsFactors = F)


  malwareRead <- malwareRead %>%
    filter(!is.na(Domain) & Domain != "-") %>%
    mutate(domainParsed = urltools::url_parse(Domain)$domain) %>%
    select(c("Date", "Domain","domainParsed", "IP", "ReverseLookup", "Description","ASN","Country"))



  return(malwareRead)
}
